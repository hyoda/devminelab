{
  "name": "í¬ë¡¤ìº£ ëŒ€ëŸ‰ìƒí’ˆë“±ë¡ ì™„ë£Œ ì•Œë¦¼",
  "nodes": [
    {
      "parameters": {
        "path": "crawlcat-bulk-upload",
        "options": {
          "noResponseBody": false
        }
      },
      "id": "crawlcat-webhook",
      "name": "í¬ë¡¤ìº£ Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [240, 300],
      "webhookId": "crawlcat-bulk-upload"
    },
    {
      "parameters": {
        "jsCode": "// í¬ë¡¤ìº£ì—ì„œ ì „ì†¡ëœ ë°ì´í„° íŒŒì‹± ë° ê²€ì¦\nconst payload = $json;\n\n// í•„ìˆ˜ ë°ì´í„° ì¶”ì¶œ\nconst taskId = payload.taskId || 'UNKNOWN';\nconst status = payload.status || 'unknown';\nconst totalProducts = payload.totalProducts || 0;\nconst successCount = payload.successCount || 0;\nconst failedCount = payload.failedCount || 0;\nconst startTime = payload.startTime;\nconst endTime = payload.endTime || new Date().toISOString();\nconst errorMessages = payload.errors || [];\n\n// ì‘ì—… ì‹œê°„ ê³„ì‚°\nlet duration = 'ê³„ì‚° ë¶ˆê°€';\nif (startTime && endTime) {\n  const start = new Date(startTime);\n  const end = new Date(endTime);\n  const diffMs = end - start;\n  const minutes = Math.floor(diffMs / 60000);\n  const seconds = Math.floor((diffMs % 60000) / 1000);\n  duration = `${minutes}ë¶„ ${seconds}ì´ˆ`;\n}\n\n// ì„±ê³µë¥  ê³„ì‚°\nconst successRate = totalProducts > 0 ? ((successCount / totalProducts) * 100).toFixed(1) : '0';\n\n// ìƒíƒœì— ë”°ë¥¸ ì´ëª¨ì§€ ë° ë©”ì‹œì§€\nlet statusEmoji = 'âœ…';\nlet statusMessage = 'ì„±ê³µ';\nlet alertLevel = 'good';\n\nif (status === 'completed_with_errors') {\n  statusEmoji = 'âš ï¸';\n  statusMessage = 'ì¼ë¶€ ì˜¤ë¥˜';\n  alertLevel = 'warning';\n} else if (status === 'failed' || successRate < 50) {\n  statusEmoji = 'âŒ';\n  statusMessage = 'ì‹¤íŒ¨';\n  alertLevel = 'danger';\n}\n\nreturn {\n  taskId,\n  status,\n  statusEmoji,\n  statusMessage,\n  alertLevel,\n  totalProducts,\n  successCount,\n  failedCount,\n  successRate,\n  duration,\n  startTime,\n  endTime,\n  errorMessages,\n  timestamp: new Date().toISOString(),\n  koreanTime: new Date().toLocaleString('ko-KR', {timeZone: 'Asia/Seoul'})\n};"
      },
      "id": "process-data",
      "name": "ë°ì´í„° ì²˜ë¦¬",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [460, 300]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "high-success-rate",
              "leftValue": "={{ parseFloat($json.successRate) }}",
              "rightValue": 90,
              "operator": {
                "type": "number",
                "operation": "gte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "if-high-success",
      "name": "ê³ ì„±ê³µë¥  (90% ì´ìƒ)",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [680, 200]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "medium-success-rate",
              "leftValue": "={{ parseFloat($json.successRate) }}",
              "rightValue": 50,
              "operator": {
                "type": "number",
                "operation": "gte"
              }
            },
            {
              "id": "not-high-success",
              "leftValue": "={{ parseFloat($json.successRate) }}",
              "rightValue": 90,
              "operator": {
                "type": "number",
                "operation": "lt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "if-medium-success",
      "name": "ì¤‘ê°„ì„±ê³µë¥  (50-90%)",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [680, 400]
    },
    {
      "parameters": {
        "url": "={{ $env.SLACK_WEBHOOK_URL }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"text\": \"ğŸš€ í¬ë¡¤ìº£ ëŒ€ëŸ‰ìƒí’ˆë“±ë¡ ì™„ë£Œ!\",\n  \"blocks\": [\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"*ğŸš€ í¬ë¡¤ìº£ ëŒ€ëŸ‰ìƒí’ˆë“±ë¡ ì„±ê³µ!*\\n\\n{{ $json.statusEmoji }} *ì‘ì—… ì™„ë£Œ - {{ $json.statusMessage }}*\"\n      }\n    },\n    {\n      \"type\": \"section\",\n      \"fields\": [\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*ì‘ì—… ID:*\\n{{ $json.taskId }}\"\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*ì´ ìƒí’ˆ ìˆ˜:*\\n{{ $json.totalProducts }}ê°œ\"\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*ì„±ê³µ:*\\n{{ $json.successCount }}ê°œ\"\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*ì‹¤íŒ¨:*\\n{{ $json.failedCount }}ê°œ\"\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*ì„±ê³µë¥ :*\\n{{ $json.successRate }}%\"\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*ì†Œìš”ì‹œê°„:*\\n{{ $json.duration }}\"\n        }\n      ]\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"*ì™„ë£Œ ì‹œê°„:* {{ $json.koreanTime }}\\n\\nğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ë†’ì€ ì„±ê³µë¥ ë¡œ ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\"\n      }\n    },\n    {\n      \"type\": \"actions\",\n      \"elements\": [\n        {\n          \"type\": \"button\",\n          \"text\": {\n            \"type\": \"plain_text\",\n            \"text\": \"í¬ë¡¤ìº£ í™•ì¸\"\n          },\n          \"url\": \"https://crawlcat.hyoda.kr\",\n          \"style\": \"primary\"\n        }\n      ]\n    }\n  ]\n}",
        "options": {}
      },
      "id": "high-success-notification",
      "name": "ê³ ì„±ê³µë¥  ì•Œë¦¼",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [900, 100]
    },
    {
      "parameters": {
        "url": "={{ $env.SLACK_WEBHOOK_URL }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"text\": \"âš ï¸ í¬ë¡¤ìº£ ëŒ€ëŸ‰ìƒí’ˆë“±ë¡ ì¼ë¶€ ì˜¤ë¥˜\",\n  \"blocks\": [\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"*âš ï¸ í¬ë¡¤ìº£ ëŒ€ëŸ‰ìƒí’ˆë“±ë¡ ì™„ë£Œ (ì¼ë¶€ ì˜¤ë¥˜)*\\n\\n{{ $json.statusEmoji }} *ì‘ì—… ì™„ë£Œ - {{ $json.statusMessage }}*\"\n      }\n    },\n    {\n      \"type\": \"section\",\n      \"fields\": [\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*ì‘ì—… ID:*\\n{{ $json.taskId }}\"\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*ì´ ìƒí’ˆ ìˆ˜:*\\n{{ $json.totalProducts }}ê°œ\"\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*ì„±ê³µ:*\\n{{ $json.successCount }}ê°œ\"\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*ì‹¤íŒ¨:*\\n{{ $json.failedCount }}ê°œ\"\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*ì„±ê³µë¥ :*\\n{{ $json.successRate }}%\"\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*ì†Œìš”ì‹œê°„:*\\n{{ $json.duration }}\"\n        }\n      ]\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"*ì™„ë£Œ ì‹œê°„:* {{ $json.koreanTime }}\\n\\nğŸ’¡ ì¼ë¶€ ìƒí’ˆì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë¡œê·¸ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.\"\n      }\n    },\n    {\n      \"type\": \"actions\",\n      \"elements\": [\n        {\n          \"type\": \"button\",\n          \"text\": {\n            \"type\": \"plain_text\",\n            \"text\": \"ì˜¤ë¥˜ í™•ì¸\"\n          },\n          \"url\": \"https://crawlcat.hyoda.kr\",\n          \"style\": \"primary\"\n        }\n      ]\n    }\n  ]\n}",
        "options": {}
      },
      "id": "medium-success-notification",
      "name": "ì¤‘ê°„ì„±ê³µë¥  ì•Œë¦¼",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [900, 300]
    },
    {
      "parameters": {
        "url": "={{ $env.SLACK_WEBHOOK_URL }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"text\": \"ğŸš¨ í¬ë¡¤ìº£ ëŒ€ëŸ‰ìƒí’ˆë“±ë¡ ì‹¤íŒ¨!\",\n  \"blocks\": [\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"*ğŸš¨ í¬ë¡¤ìº£ ëŒ€ëŸ‰ìƒí’ˆë“±ë¡ ì‹¤íŒ¨*\\n\\n{{ $json.statusEmoji }} *ì‘ì—… ì‹¤íŒ¨ - {{ $json.statusMessage }}*\"\n      }\n    },\n    {\n      \"type\": \"section\",\n      \"fields\": [\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*ì‘ì—… ID:*\\n{{ $json.taskId }}\"\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*ì´ ìƒí’ˆ ìˆ˜:*\\n{{ $json.totalProducts }}ê°œ\"\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*ì„±ê³µ:*\\n{{ $json.successCount }}ê°œ\"\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*ì‹¤íŒ¨:*\\n{{ $json.failedCount }}ê°œ\"\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*ì„±ê³µë¥ :*\\n{{ $json.successRate }}%\"\n        },\n        {\n          \"type\": \"mrkdwn\",\n          \"text\": \"*ì†Œìš”ì‹œê°„:*\\n{{ $json.duration }}\"\n        }\n      ]\n    },\n    {\n      \"type\": \"section\",\n      \"text\": {\n        \"type\": \"mrkdwn\",\n        \"text\": \"*ì‹¤íŒ¨ ì‹œê°„:* {{ $json.koreanTime }}\\n\\nâš ï¸ ì¦‰ì‹œ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤! ì„±ê³µë¥ ì´ 50% ë¯¸ë§Œì…ë‹ˆë‹¤.\"\n      }\n    },\n    {\n      \"type\": \"actions\",\n      \"elements\": [\n        {\n          \"type\": \"button\",\n          \"text\": {\n            \"type\": \"plain_text\",\n            \"text\": \"ê¸´ê¸‰ í™•ì¸\"\n          },\n          \"url\": \"https://crawlcat.hyoda.kr\",\n          \"style\": \"danger\"\n        }\n      ]\n    }\n  ]\n}",
        "options": {}
      },
      "id": "low-success-notification",
      "name": "ì €ì„±ê³µë¥  ì•Œë¦¼",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [900, 500]
    }
  ],
  "pinData": {},
  "connections": {
    "í¬ë¡¤ìº£ Webhook": {
      "main": [
        [
          {
            "node": "ë°ì´í„° ì²˜ë¦¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë°ì´í„° ì²˜ë¦¬": {
      "main": [
        [
          {
            "node": "ê³ ì„±ê³µë¥  (90% ì´ìƒ)",
            "type": "main",
            "index": 0
          },
          {
            "node": "ì¤‘ê°„ì„±ê³µë¥  (50-90%)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ê³ ì„±ê³µë¥  (90% ì´ìƒ)": {
      "main": [
        [
          {
            "node": "ê³ ì„±ê³µë¥  ì•Œë¦¼",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ì €ì„±ê³µë¥  ì•Œë¦¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì¤‘ê°„ì„±ê³µë¥  (50-90%)": {
      "main": [
        [
          {
            "node": "ì¤‘ê°„ì„±ê³µë¥  ì•Œë¦¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "1",
  "meta": {
    "templateCredsSetupCompleted": true
  }
}